## Цель домашнего задания
-------------------------- 
Научиться самостоятельно развернуть сервис NFS и подключить к нему клиента.
## Описание домашнего задания 

    - `vagrant up` должен поднимать 2 настроенных виртуальных машины (сервер NFS и клиента) без дополнительных ручных действий; - на сервере NFS должна быть подготовлена и экспортирована директория; 
    - в экспортированной директории должна быть поддиректория с именем __upload__ с правами на запись в неё; 
    - экспортированная директория должна автоматически монтироваться на клиенте при старте виртуальной машины (systemd, autofs или fstab -  любым способом); 
    - монтирование и работа NFS на клиенте должна быть организована с использованием NFSv3 по протоколу UDP; 
    - firewall должен быть включен и настроен как на клиенте, так и на сервере.

 ### Настраиваем сервер NFS 

заходим на сервер `vagrant ssh nfss`

Дальнейшие действия выполняются __от имени пользователя имеющего повышенные привилегии__, разрешающие описанные действия.     
Cервер NFS уже установлен в CentOS 7 как часть дистрибутива, так что нам нужно лишь доустановить утилиты, которые облегчат отладку `yum install nfs-utils`.     
Включаем firewall и проверяем, что он работает (доступ к SSH обычно включен по умолчанию, поэтому здесь мы его не затрагиваем, но имейте это ввиду, если настраиваете firewall с нуля)    
 
    **systemctl enable firewalld --now    
    systemctl status firewalld**    
    
Разрешаем в firewall доступ к сервисам NFS     
```bash 
firewall-cmd --add-service="nfs3" \ 
 --add-service="rpc-bind" \ 
 --add-service="mountd" \ 
 --permanent 
firewall-cmd --reload 
``` 
Включаем сервер NFS (для конфигурации NFSv3 over UDP он не требует дополнительной настройки, однако вы можете ознакомиться с умолчаниями в файле __/etc/nfs.conf__) 
```bash 
systemctl enable nfs --now 
``` 
Проверяем наличие слушаемых портов 2049/udp, 2049/tcp, 20048/udp,  20048/tcp, 111/udp, 111/tcp (не все они будут использоваться далее,  но их наличие сигнализирует о том, что необходимые сервисы готовы принимать внешние подключения)        
``` 
ss -tnplu 
``` 
- создаём и настраиваем директорию, которая будет экспортирована в будущем 
```bash 
mkdir -p /srv/share/upload     
chown -R nfsnobody:nfsnobody /srv/share      
chmod 0777 /srv/share/upload      
``` 

Создаём в файле __/etc/exports__ структуру, которая позволит экспортировать ранее созданную директорию 
```bash 
cat << EOF > /etc/exports 
/srv/share 192.168.50.11/32(rw,sync,root_squash) 
EOF 
``` 
- экспортируем ранее созданную директорию    
```bash 
exportfs -r 
``` 
- проверяем экспортированную директорию следующей командой     
```bash 
exportfs -s 
``` 
 
exportfs -s
------------ 
```
    /srv/share  
    192.168.50.11/32(sync,wdelay,hide,no_subtree_check,sec=sys,rw,secure,root_squash,no_all_squash) 
```

### Настраиваем клиент NFS 

Заходим на сервер 
```bash 
vagrant ssh nfsc 
``` 
Дальнейшие действия выполняются __от имени пользователя имеющего повышенные привилегии__, разрешающие описанные действия.     
Доустановим вспомогательные утилиты     
```bash 
yum install nfs-utils 
``` 
Включаем firewall и проверяем, что он работает (доступ к SSH  обычно включен по умолчанию, поэтому здесь мы его не затрагиваем.    
 ```bash 
systemctl enable firewalld --now 
systemctl status firewalld 
``` 

Добавляем в __/etc/fstab__ строку_ 
``` 
echo "192.168.50.10:/srv/share/ /mnt nfs vers=3,proto=udp,noauto,x-systemd.automount 0 0" >> /etc/fstab 
``` 
и выполняем     
```bash 
systemctl daemon-reload 
systemctl restart remote-fs.target 
``` 
Отметим, что в данном случае происходит автоматическая генерация systemd units в каталоге `/run/systemd/generator/`, которые производят монтирование при первом обращении к каталогу `/mnt/` - заходим в директорию `/mnt/` и проверяем успешность монтирования    
 ```bash 
mount | grep mnt 
``` 
При успехе вывод должен примерно соответствовать этому    
``` 
mount | grep mnt 
systemd-1 on /mnt type autofs  
(rw,relatime,fd=46,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pip e_ino=26801) 
192.168.50.10:/srv/share/ on /mnt type nfs  
(rw,relatime,vers=3,rsize=32768,wsize=32768,namlen=255,hard,proto=ud p,timeo=11,retrans=3,sec=sys,mountaddr=192.168.50.10,mountvers=3,mou ntport=20048,mountproto=udp,local_lock=none,addr=192.168.50.10) ``` 
Обратите внимание на `vers=3` и `proto=udp`, что соотвествует NFSv3  over UDP, как того требует задание.

### Проверка работоспособности 
- заходим на сервер 
- заходим в каталог `/srv/share/upload` 
- создаём тестовый файл `touch check_file` 
- заходим на клиент 
- заходим в каталог `/mnt/upload` 
- проверяем наличие ранее созданного файла 
- создаём тестовый файл `touch client_file` 
- проверяем, что файл успешно создан 
Если вышеуказанные проверки прошли успешно, это значит, что проблем с правами нет.

### Предварительно проверяем клиент: 
- перезагружаем клиент 
- заходим на клиент 
- заходим в каталог `/mnt/upload` 
- проверяем наличие ранее созданных файлов




